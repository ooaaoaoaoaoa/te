<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4æŠã‚¯ã‚¤ã‚ºBot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary-color: #4a90e2; --bg-color: #f5f7fa; }
        body { font-family: sans-serif; background-color: var(--bg-color); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #quiz-container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 90%; max-width: 600px; }
        .header { display: flex; justify-content: space-between; margin-bottom: 1rem; color: #666; }
        .question-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; }
        .options-grid { display: grid; gap: 10px; }
        button { padding: 1rem; border-radius: 8px; cursor: pointer; font-weight: bold; border: none; transition: 0.2s; }
        .option-btn { background: white; border: 2px solid #ddd; text-align: left; }
        .option-btn:hover { background-color: #f0f7ff; border-color: var(--primary-color); }
        .next-btn, .retry-btn { background-color: var(--primary-color); color: white; width: 100%; margin-top: 1rem; }
        .feedback { margin-top: 1rem; padding: 1rem; border-radius: 8px; display: none; }
        .correct { background-color: #d4edda; color: #155724; }
        .wrong { background-color: #f8d7da; color: #721c24; }
        .hidden { display: none; }
        .menu-item { display: block; width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; background: #eee; text-align: left; border-radius: 5px; text-decoration: none; color: #333; }
    </style>
</head>
<body>

<div id="quiz-container">
    <div id="setup-screen">
        <h2 id="title">ã‚¯ã‚¤ã‚ºã‚’é¸æŠ</h2>
        <div id="status-msg">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="file-menu" style="margin-top: 1rem;"></div>
        <button class="next-btn hidden" id="start-btn">ã“ã®ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹</button>
    </div>

    <div id="game-screen" class="hidden">
        <div class="header"><span id="progress"></span><span id="score-display"></span></div>
        <div class="question-text" id="question"></div>
        <div class="options-grid" id="options-container"></div>
        <div id="feedback-area" class="feedback">
            <b id="result-label"></b>
            <div id="explanation-text" style="margin-top:0.5rem; font-size:0.9rem;"></div>
            <button class="next-btn" id="next-question-btn">æ¬¡ã¸</button>
        </div>
    </div>

    <div id="result-screen" class="result-screen hidden">
        <h2 style="text-align:center">çµæœ</h2>
        <p style="text-align:center; font-size: 2rem;"><span id="final-score">0</span> / <span id="total-questions">0</span></p>
        <button class="retry-btn" id="retry-wrong-btn">é–“é•ãˆãŸå•é¡Œã®ã¿ãƒªãƒˆãƒ©ã‚¤</button>
        <button class="retry-btn" id="restart-btn" style="background-color: #95a5a6;">æœ€åˆã‹ã‚‰è§£ãç›´ã™</button>
    </div>
</div>

<script>
    // --- ã€è¨­å®šã€‘ ---
    const GITHUB_USER = 'ooaaoaoaoaoa'; 
    const GITHUB_REPO = 'te';
    const FOLDER_PATH = ''; // åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    // ----------------

    let allQuestions = [];
    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let wrongQuestions = [];

    async function init() {
        const hash = window.location.hash.replace('#', ''); // URLã®#ä»¥é™ã‚’å–å¾—
        const statusMsg = document.getElementById('status-msg');
        const menu = document.getElementById('file-menu');

        try {
            const apiUrl = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FOLDER_PATH}`;
            const response = await fetch(apiUrl);
            const files = await response.json();
            const csvFiles = files.filter(f => f.name.toLowerCase().endsWith('.csv'));

            if (hash) {
                // ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆï¼šãã®ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘èª­ã¿è¾¼ã‚“ã§å³é–‹å§‹
                const targetFile = csvFiles.find(f => f.name.replace('.csv', '') === hash);
                if (targetFile) {
                    statusMsg.innerText = `ã€Œ${hash}ã€ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...`;
                    await loadCSV(targetFile.download_url);
                    startQuiz(allQuestions);
                } else {
                    statusMsg.innerText = `ã‚¨ãƒ©ãƒ¼: ${hash}.csv ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`;
                    showMenu(csvFiles);
                }
            } else {
                // ãƒãƒƒã‚·ãƒ¥ãŒãªã„å ´åˆï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
                statusMsg.innerText = "è§£ããŸã„ã‚¯ã‚¤ã‚ºã‚’é¸ã‚“ã§ãã ã•ã„ï¼š";
                showMenu(csvFiles);
            }
        } catch (e) {
            statusMsg.innerText = "ã‚¨ãƒ©ãƒ¼: èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        }
    }

    function showMenu(files) {
        const menu = document.getElementById('file-menu');
        files.forEach(f => {
            const name = f.name.replace('.csv', '');
            const btn = document.createElement('a');
            btn.href = `#${name}`;
            btn.className = 'menu-item';
            btn.innerText = `ğŸ“„ ${name}`;
            btn.onclick = () => { setTimeout(() => location.reload(), 10); };
            menu.appendChild(btn);
        });
    }

    async function loadCSV(url) {
        const resp = await fetch(url);
        const text = await resp.text();
        const results = Papa.parse(text, { header: true, skipEmptyLines: true, dynamicTyping: true });
        allQuestions = results.data.map(row => ({
            question: row['å•é¡Œæ–‡'],
            options: [row['é¸æŠè‚¢1'], row['é¸æŠè‚¢2'], row['é¸æŠè‚¢3'], row['é¸æŠè‚¢4']],
            answer: parseInt(row['æ­£è§£']),
            explanation: row['è§£èª¬']
        })).filter(q => q.question);
    }

    function startQuiz(qs) {
        currentQuestions = [...qs];
        currentIndex = 0; score = 0; wrongQuestions = [];
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const q = currentQuestions[currentIndex];
        document.getElementById('progress').innerText = `${currentIndex + 1} / ${currentQuestions.length}`;
        document.getElementById('score-display').innerText = `ã‚¹ã‚³ã‚¢: ${score}`;
        document.getElementById('question').innerText = q.question;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        document.getElementById('feedback-area').style.display = 'none';

        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => {
                container.querySelectorAll('button').forEach(b => b.disabled = true);
                const isCorrect = (i + 1) === q.answer;
                if (isCorrect) {
                    score++;
                    document.getElementById('result-label').innerText = "â— æ­£è§£ï¼";
                    document.getElementById('feedback-area').className = "feedback correct";
                } else {
                    wrongQuestions.push(q);
                    document.getElementById('result-label').innerText = `Ã— ä¸æ­£è§£ (æ­£è§£: ${q.answer})`;
                    document.getElementById('feedback-area').className = "feedback wrong";
                }
                document.getElementById('explanation-text').innerText = q.explanation || "";
                document.getElementById('feedback-area').style.display = 'block';
            };
            container.appendChild(btn);
        });
    }

    document.getElementById('next-question-btn').onclick = () => {
        currentIndex++;
        if (currentIndex < currentQuestions.length) showQuestion();
        else {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('total-questions').innerText = currentQuestions.length;
            document.getElementById('retry-wrong-btn').classList.toggle('hidden', !wrongQuestions.length);
        }
    };

    document.getElementById('restart-btn').onclick = () => startQuiz(allQuestions);
    document.getElementById('retry-wrong-btn').onclick = () => startQuiz(wrongQuestions);

    init();
</script>
</body>
</html>
